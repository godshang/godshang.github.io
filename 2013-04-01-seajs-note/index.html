<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"godshang.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="What is SeaJS ?官方的描述：">
<meta property="og:type" content="article">
<meta property="og:title" content="SeaJS学习笔记">
<meta property="og:url" content="https://godshang.github.io/2013-04-01-seajs-note/index.html">
<meta property="og:site_name" content="上元君的博客">
<meta property="og:description" content="What is SeaJS ?官方的描述：">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2013-03-31T16:00:00.000Z">
<meta property="article:modified_time" content="2025-01-15T15:17:02.666Z">
<meta property="article:author" content="alan">
<meta property="article:tag" content="JavaScript">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://godshang.github.io/2013-04-01-seajs-note/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://godshang.github.io/2013-04-01-seajs-note/","path":"2013-04-01-seajs-note/","title":"SeaJS学习笔记"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>SeaJS学习笔记 | 上元君的博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">上元君的博客</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">静听星空夜语 淡看物是人非</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-note"><a href="https://godshang.github.io/note/" rel="section"><i class="fa fa-book fa-fw"></i>note</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#What-is-SeaJS"><span class="nav-number">1.</span> <span class="nav-text">What is SeaJS ?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%98%E8%B5%B7"><span class="nav-number">2.</span> <span class="nav-text">缘起</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E5%90%8D%E5%86%B2%E7%AA%81"><span class="nav-number">2.1.</span> <span class="nav-text">命名冲突</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%BE%9D%E8%B5%96"><span class="nav-number">2.2.</span> <span class="nav-text">文件依赖</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8SeaJS"><span class="nav-number">3.</span> <span class="nav-text">使用SeaJS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SeaJS%E5%9F%BA%E6%9C%AC%E5%BC%80%E5%8F%91%E5%8E%9F%E5%88%99"><span class="nav-number">4.</span> <span class="nav-text">SeaJS基本开发原则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8F%8A%E7%BC%96%E5%86%99"><span class="nav-number">5.</span> <span class="nav-text">模块的定义及编写</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0define"><span class="nav-number">5.1.</span> <span class="nav-text">模块定义函数define</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%A5%E5%8E%82%E5%87%BD%E6%95%B0factory"><span class="nav-number">5.2.</span> <span class="nav-text">工厂函数factory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E7%A7%8D%E7%BC%96%E5%86%99%E6%A8%A1%E5%9D%97%E7%9A%84%E6%A8%A1%E5%BC%8F"><span class="nav-number">5.3.</span> <span class="nav-text">三种编写模块的模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E7%9A%84%E8%BD%BD%E5%85%A5%E5%92%8C%E5%BC%95%E7%94%A8"><span class="nav-number">6.</span> <span class="nav-text">模块的载入和引用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#seajs-use"><span class="nav-number">6.1.</span> <span class="nav-text">seajs.use</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#require"><span class="nav-number">6.2.</span> <span class="nav-text">require</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#require-async"><span class="nav-number">6.3.</span> <span class="nav-text">require.async</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SeaJS%E7%9A%84%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE"><span class="nav-number">7.</span> <span class="nav-text">SeaJS的全局配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SeaJS%E5%A6%82%E4%BD%95%E4%B8%8E%E7%8E%B0%E6%9C%89JS%E5%BA%93%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8"><span class="nav-number">8.</span> <span class="nav-text">SeaJS如何与现有JS库配合使用</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">alan</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">71</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://godshang.github.io/2013-04-01-seajs-note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="alan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="上元君的博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="SeaJS学习笔记 | 上元君的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SeaJS学习笔记
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2013-04-01 00:00:00" itemprop="dateCreated datePublished" datetime="2013-04-01T00:00:00+08:00">2013-04-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-01-15 23:17:02" itemprop="dateModified" datetime="2025-01-15T23:17:02+08:00">2025-01-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="What-is-SeaJS"><a href="#What-is-SeaJS" class="headerlink" title="What is SeaJS ?"></a>What is SeaJS ?</h2><p>官方的描述：</p>
<blockquote>
<p>SeaJS 是一个遵循 CommonJS 规范的模块加载框架，可用来轻松愉悦地加载任意 JavaScript 模块，一个文件就是一个模块，依赖关系也只需遵守简单约定，无需冗长的配置。使用 SeaJS, 能让你更关注于编码的乐趣。</p>
</blockquote>
<h2 id="缘起"><a href="#缘起" class="headerlink" title="缘起"></a>缘起</h2><h3 id="命名冲突"><a href="#命名冲突" class="headerlink" title="命名冲突"></a>命名冲突</h3><p>我们从一个简单的习惯出发。项目开发时常常会将一些通用的、底层的功能抽象出来，独立成一个个函数，比如</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> is<span class="constructor">String(<span class="params">arr</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 实现代码</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> is<span class="constructor">Array(<span class="params">str</span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 实现代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>把这些函数统一放在util.js里。需要用到时，引入该文件就行。但假设多个库有同名方法时，就有出现命名冲突的现象。</p>
<p>参照Java的方式，通过引入命名空间来解决。</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">var com <span class="operator">=</span> &#123;&#125;<span class="comment">;</span></span><br><span class="line">com.sogou <span class="operator">=</span> &#123;&#125;<span class="comment">;</span></span><br><span class="line">com.sogou.Utils <span class="operator">=</span> &#123;&#125;<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">com.sogou.Utils.isString <span class="operator">=</span> function (arr) &#123;</span><br><span class="line">  // 实现代码</span><br><span class="line">&#125;<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">com.sogou.Utils.isArray <span class="operator">=</span> function (str) &#123;</span><br><span class="line">  // 实现代码</span><br><span class="line">&#125;<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>使用时</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (com.sogou.<span class="module-access"><span class="module"><span class="identifier">Utils</span>.</span></span>is<span class="constructor">String(<span class="params">response</span>)</span>) &#123;</span><br><span class="line">  <span class="comment">// 实现代码</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (com.sogou.<span class="module-access"><span class="module"><span class="identifier">Utils</span>.</span></span>is<span class="constructor">Array(<span class="params">response</span>)</span>) &#123;</span><br><span class="line">  <span class="comment">// 实现代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过命名空间，的确能极大缓解冲突。但过长的命名空间给编码带来很大麻烦。</p>
<h3 id="文件依赖"><a href="#文件依赖" class="headerlink" title="文件依赖"></a>文件依赖</h3><p>假设现有多个js文件：</p>
<figure class="highlight arcade"><table><tr><td class="code"><pre><span class="line"><span class="comment">//module1.js</span></span><br><span class="line"><span class="keyword">var</span> module1 = &#123;</span><br><span class="line">    <span class="attr">run</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> $.merge([<span class="string">&#x27;module1&#x27;</span>], $.merge(module2.run(), module3.run()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//module2.js</span></span><br><span class="line"><span class="keyword">var</span> module1 = &#123;</span><br><span class="line">    <span class="attr">run</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;module2&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//module3.js</span></span><br><span class="line"><span class="keyword">var</span> module3 = &#123;</span><br><span class="line">    <span class="attr">run</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> $.merge([<span class="string">&#x27;module3&#x27;</span>], module4.run());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//module4.js</span></span><br><span class="line"><span class="keyword">var</span> module4 = &#123;</span><br><span class="line">    <span class="attr">run</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;module4&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时index.html需要引用module1.js及其所有下层依赖（注意顺序）</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>TinyApp<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./jquery-min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./module4.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./module2.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./module3.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./module1.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;.content&#x27;</span>).<span class="title function_">html</span>(module1.<span class="title function_">run</span>());</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>随着项目的进行，js文件会越来越多，依赖关系也会越来越复杂，使得js代码和html里的script列表往往变得难以维护。</p>
<h2 id="使用SeaJS"><a href="#使用SeaJS" class="headerlink" title="使用SeaJS"></a>使用SeaJS</h2><p>首先是index.html：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">HTML</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>TinyApp<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./sea.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        seajs.<span class="title function_">use</span>(<span class="string">&#x27;./init&#x27;</span>, <span class="keyword">function</span>(<span class="params">init</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            init.<span class="title function_">initPage</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到html页面不再需要引入所有依赖的js文件，而只是引入一个sea.js，sea.js会处理所有依赖，加载相应的js文件。</p>
<p>index.html加载了init模块，并使用此模块的initPage方法初始化页面数据，这里先不讨论代码细节。</p>
<p>下面看一下模块化后JavaScript的写法：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//jquery.js</span></span><br><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) = &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//原jquery.js代码...</span></span><br><span class="line"> </span><br><span class="line">    <span class="variable language_">module</span>.<span class="property">exports</span> = $.<span class="title function_">noConflict</span>(<span class="literal">true</span>);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//init.js</span></span><br><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) = &#123;</span><br><span class="line">    <span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">&#x27;jquery&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> m1 = <span class="built_in">require</span>(<span class="string">&#x27;module1&#x27;</span>);</span><br><span class="line">     </span><br><span class="line">    <span class="built_in">exports</span>.<span class="property">initPage</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        $(<span class="string">&#x27;.content&#x27;</span>).<span class="title function_">html</span>(m1.<span class="title function_">run</span>());    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//module1.js</span></span><br><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) = &#123;</span><br><span class="line">    <span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">&#x27;jquery&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> m2 = <span class="built_in">require</span>(<span class="string">&#x27;module2&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> m3 = <span class="built_in">require</span>(<span class="string">&#x27;module3&#x27;</span>);</span><br><span class="line">     </span><br><span class="line">    <span class="built_in">exports</span>.<span class="property">run</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> $.<span class="title function_">merge</span>([<span class="string">&#x27;module1&#x27;</span>], $.<span class="title function_">merge</span>(m2.<span class="title function_">run</span>(), m3.<span class="title function_">run</span>()));    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//module2.js</span></span><br><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) = &#123;</span><br><span class="line">    <span class="built_in">exports</span>.<span class="property">run</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;module2&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//module3.js</span></span><br><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) = &#123;</span><br><span class="line">    <span class="keyword">var</span> $ = <span class="built_in">require</span>(<span class="string">&#x27;jquery&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> m4 = <span class="built_in">require</span>(<span class="string">&#x27;module4&#x27;</span>);</span><br><span class="line">     </span><br><span class="line">    <span class="built_in">exports</span>.<span class="property">run</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> $.<span class="title function_">merge</span>([<span class="string">&#x27;module3&#x27;</span>], m4.<span class="title function_">run</span>());    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//module4.js</span></span><br><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) = &#123;</span><br><span class="line">    <span class="built_in">exports</span>.<span class="property">run</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;module4&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>乍看之下代码似乎变多变复杂了，这是因为这个例子太简单，如果是大型项目，SeaJS代码的优势就会显现出来。</p>
<p>不过从这里我们还是能窥探到一些SeaJS的特性：</p>
<ul>
<li>一是html页面不用再维护冗长的script标签列表，只要引入一个sea.js即可。</li>
<li>二是js代码以模块进行组织，各个模块通过require引入自己依赖的模块，代码清晰明了。</li>
</ul>
<h2 id="SeaJS基本开发原则"><a href="#SeaJS基本开发原则" class="headerlink" title="SeaJS基本开发原则"></a>SeaJS基本开发原则</h2><p>使用SeaJS开发JavaScript的基本原则就是：一切皆为模块。引入SeaJS后，编写JavaScript代码就变成了编写一个又一个模块，SeaJS中模块的概念有点类似于面向对象中的类——模块可以拥有数据和方法，数据和方法可以定义为公共或私有，公共数据和方法可以供别的模块调用。</p>
<p>另外，每个模块应该都定义在一个单独js文件中，即一个对应一个模块。</p>
<h2 id="模块的定义及编写"><a href="#模块的定义及编写" class="headerlink" title="模块的定义及编写"></a>模块的定义及编写</h2><h3 id="模块定义函数define"><a href="#模块定义函数define" class="headerlink" title="模块定义函数define"></a>模块定义函数define</h3><p>SeaJS中使用“define”函数定义一个模块。</p>
<figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Module</span>._define = <span class="function"><span class="keyword">function</span><span class="params">(id, deps, factory)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">seajs.define = <span class="keyword">Module</span>._define</span><br></pre></td></tr></table></figure>

<p>define可以接收三个参数，分别是模块ID，依赖模块数组及工厂函数。define对于不同参数个数的解析规则如下：</p>
<ul>
<li>如果只有一个参数，则赋值给factory。</li>
<li>如果有两个参数，第二个赋值给factory；第一个如果是array则赋值给deps，否则赋值给id。</li>
<li>如果有三个参数，则分别赋值给id，deps和factory。</li>
</ul>
<p>当使用一个参数的define定义模块。那么id和deps会怎么处理呢？</p>
<p>id是一个模块的标识字符串，define只有一个参数时，id会被默认赋值为此js文件的绝对路径。如example.com下的a.js文件中使用define定义模块，则这个模块的ID会赋值为“<a target="_blank" rel="noopener" href="http://example.com/a.js%E2%80%9D%EF%BC%8C%E6%B2%A1%E6%9C%89%E7%89%B9%E5%88%AB%E7%9A%84%E5%BF%85%E8%A6%81%E5%BB%BA%E8%AE%AE%E4%B8%8D%E8%A6%81%E4%BC%A0%E5%85%A5id%E3%80%82deps%E4%B8%80%E8%88%AC%E4%B8%8D%E9%9C%80%E8%A6%81%E4%BC%A0%E5%85%A5%EF%BC%8C%E9%9C%80%E8%A6%81%E7%94%A8%E5%88%B0%E7%9A%84%E6%A8%A1%E5%9D%97%E7%94%A8require%E5%8A%A0%E8%BD%BD%E5%8D%B3%E5%8F%AF%E3%80%82">http://example.com/a.js”，没有特别的必要建议不要传入id。deps一般不需要传入，需要用到的模块用require加载即可。</a></p>
<h3 id="工厂函数factory"><a href="#工厂函数factory" class="headerlink" title="工厂函数factory"></a>工厂函数factory</h3><p>工厂函数是模块的主体和重点。在只传递一个参数给define时（推荐写法），这个参数就是工厂函数，此时工厂函数的三个参数分别是：</p>
<ul>
<li>require——模块加载函数，用于记载依赖模块。</li>
<li>exports——接口点，将数据或方法定义在其上则将其暴露给外部调用。</li>
<li>module——模块的元数据。</li>
</ul>
<p>这三个参数可以根据需要选择是否需要显示指定。</p>
<p>下面说一下module。module是一个对象，存储了模块的元信息，具体如下：</p>
<ul>
<li>module.id——模块的ID。</li>
<li>module.dependencies——一个数组，存储了此模块依赖的所有模块的ID列表。</li>
<li>module.exports——与exports指向同一个对象。</li>
</ul>
<h3 id="三种编写模块的模式"><a href="#三种编写模块的模式" class="headerlink" title="三种编写模块的模式"></a>三种编写模块的模式</h3><p>第一种定义模块的模式是基于exports的模式：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">&#x27;a&#x27;</span>); <span class="comment">//引入a模块</span></span><br><span class="line">    <span class="keyword">var</span> b = <span class="built_in">require</span>(<span class="string">&#x27;b&#x27;</span>); <span class="comment">//引入b模块</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">var</span> data1 = <span class="number">1</span>; <span class="comment">//私有数据</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">var</span> func1 = <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="comment">//私有方法</span></span><br><span class="line">        <span class="keyword">return</span> a.<span class="title function_">run</span>(data1);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">exports</span>.<span class="property">data2</span> = <span class="number">2</span>; <span class="comment">//公共数据</span></span><br><span class="line"> </span><br><span class="line">    <span class="built_in">exports</span>.<span class="property">func2</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="comment">//公共方法</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>除了将公共数据和方法附加在exports上，也可以直接返回一个对象表示模块。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">&#x27;a&#x27;</span>); <span class="comment">//引入a模块</span></span><br><span class="line">    <span class="keyword">var</span> b = <span class="built_in">require</span>(<span class="string">&#x27;b&#x27;</span>); <span class="comment">//引入b模块</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">var</span> data1 = <span class="number">1</span>; <span class="comment">//私有数据</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">var</span> func1 = <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="comment">//私有方法</span></span><br><span class="line">        <span class="keyword">return</span> a.<span class="title function_">run</span>(data1);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">data2</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">func2</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>如果模块定义没有其它代码，只返回一个对象，还可以有如下简化写法：</p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line">define(&#123;</span><br><span class="line">    data: <span class="number">1</span>,</span><br><span class="line">    func: <span class="keyword">function</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="模块的载入和引用"><a href="#模块的载入和引用" class="headerlink" title="模块的载入和引用"></a>模块的载入和引用</h2><h3 id="seajs-use"><a href="#seajs-use" class="headerlink" title="seajs.use"></a>seajs.use</h3><p>seajs.use主要用于载入入口模块。入口模块相当于C程序的main函数，同时也是整个模块依赖树的根。seajs.use用法如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//单一模式</span></span><br><span class="line">seajs.<span class="keyword">use</span>(<span class="string">&#x27;./a&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//回调模式</span></span><br><span class="line">seajs.<span class="keyword">use</span>(<span class="string">&#x27;./a&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  a.<span class="title function_ invoke__">run</span>();</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//多模块模式</span></span><br><span class="line">seajs.<span class="keyword">use</span>([<span class="string">&#x27;./a&#x27;</span>, <span class="string">&#x27;./b&#x27;</span>], <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  a.<span class="title function_ invoke__">run</span>();</span><br><span class="line">  b.<span class="title function_ invoke__">run</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>一般seajs.use只用在页面载入入口模块，SeaJS会顺着入口模块解析所有依赖模块并将它们加载。</p>
<h3 id="require"><a href="#require" class="headerlink" title="require"></a>require</h3><p>require是SeaJS主要的模块加载方法，当在一个模块中需要用到其它模块时一般用require加载：</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">var m</span> = require(<span class="string">&#x27;/path/to/module/file&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>除了在require中使用路径来加载外，还可以使用别名来接在。别名的配置在seajs.config中，后面会介绍到。</p>
<p>这里简要介绍一下SeaJS的自动加载机制。上文说过，使用SeaJS后html只要包含sea.js即可，那么其它js文件是如何加载进来的呢？SeaJS会首先下载入口模块，然后顺着入口模块使用正则表达式匹配代码中所有的require，再根据require中的文件路径标识下载相应的js文件，对下载来的js文件再迭代进行类似操作。整个过程类似图的遍历操作（因为可能存在交叉循环依赖所以整个依赖数据结构是一个图而不是树）。</p>
<p>明白了上面这一点，下面的规则就很好理解了：</p>
<p>传给require的路径标识必须是字符串字面量，不能是表达式，如下面使用require的方法是错误的：</p>
<figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;module&#x27;</span> + <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;Module&#x27;</span>.toLowerCase());</span><br></pre></td></tr></table></figure>

<p>这都会造成SeaJS无法进行正确的正则匹配以下载相应的js文件。</p>
<h3 id="require-async"><a href="#require-async" class="headerlink" title="require.async"></a>require.async</h3><p>上文说过SeaJS会在html页面打开时通过静态分析一次性记载所有需要的js文件，如果想要某个js文件在用到时才下载，可以使用require.async：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>.<span class="title function_">async</span>(<span class="string">&#x27;/path/to/module/file&#x27;</span>, <span class="keyword">function</span>(<span class="params">m</span>) &#123;</span><br><span class="line">    <span class="comment">//code of callback...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这样只有在用到这个模块时，对应的js文件才会被下载，也就实现了JavaScript代码的按需加载。</p>
<h2 id="SeaJS的全局配置"><a href="#SeaJS的全局配置" class="headerlink" title="SeaJS的全局配置"></a>SeaJS的全局配置</h2><p>SeaJS提供了一个seajs.config方法可以设置全局配置，接收一个表示全局配置的配置对象。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">seajs.<span class="title function_ invoke__">config</span>(&#123;</span><br><span class="line">    <span class="attr">base</span>: <span class="string">&#x27;path/to/jslib/&#x27;</span>,</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;app&#x27;</span>: <span class="string">&#x27;path/to/app/&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">charset</span>: <span class="string">&#x27;utf-8&#x27;</span>,</span><br><span class="line">    <span class="attr">timeout</span>: <span class="number">20000</span>,</span><br><span class="line">    <span class="attr">debug</span>: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>其中base表示基址寻址时的基址路径。</p>
<p>alias可以对较长的常用路径设置缩写。此处的别名可以在require时使用，方便模块的加载。</p>
<p>charset表示下载js时script标签的charset属性。</p>
<p>timeout表示下载文件的最大时长，以毫秒为单位。</p>
<p>debug表示是否工作在调试模式下。</p>
<h2 id="SeaJS如何与现有JS库配合使用"><a href="#SeaJS如何与现有JS库配合使用" class="headerlink" title="SeaJS如何与现有JS库配合使用"></a>SeaJS如何与现有JS库配合使用</h2><p>要将现有JS库如jQuery与SeaJS一起使用，只需根据SeaJS的的模块定义规则对现有库进行一个封装。例如，下面是对jQuery的封装方法：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">define</span>(<span class="string">&#x27;jquery&#x27;</span>, [], <span class="keyword">function</span>(<span class="params"><span class="built_in">require</span></span>) &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// jQuery原有代码</span></span><br><span class="line">     </span><br><span class="line">    <span class="keyword">return</span> $.<span class="title function_">noConflict</span>(<span class="literal">true</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/JavaScript/" rel="tag"># JavaScript</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2012-08-15-hadoop-join/" rel="prev" title="Hadoop中数据文件的Join">
                  <i class="fa fa-angle-left"></i> Hadoop中数据文件的Join
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2013-04-02-jQuery-note/" rel="next" title="jQuery学习笔记">
                  jQuery学习笔记 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">alan</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
